{% extends 'base.html.twig' %}

{% block title %}Planning{% endblock %}

{% block body %}
<h1>Planning</h1>

<div class="card bg-light">
	<h2 class="card-header">Ajouter une entr√©e de planning</h2>
	<div class="card-body">
		{{ form_start(form) }}
		{{ form_widget(form) }}
		{{ form_end(form) }}
	</div>
</div>

	<table class="table table-sm schedule">
		<thead>
			<tr>
				{% set startDate = "01-01-2013" %}
				{% set endDate = "31-01-2013" %}
				<th>{{ startDate|date('M Y') }}</th>
				{% for x in range(startDate|date('U'), endDate|date('U'), 86400 ) %}
					<th colspan="2" class="schedDate">{{ x|date('d') }}</th>
				{% endfor %}
			</tr>
		</thead>
		<tbody>
			{% for user in users %}
			<tr>
				<th>{{ user.username }}</th>
				{% set currentPlanning = "" %}
				{% for x in range(startDate|date('U'), endDate|date('U'), 86400 ) %}
					{% set empty = true %}
					{% if currentPlanning == "" %}
						{% for planning in user.plannings if currentPlanning == "" %}
							{% if planning.startDate|date('U') == x|date('U') %}
								{% set currentPlanning = planning %}
								{% if planning.startHour == "am" %}
									<td class="schedHour schedActive"></td>
								{% else %}
									<td class="schedHour"></td>
								{% endif %}
								<td class="schedHour schedActive"></td>
								{% set empty = false %}
							{% elseif planning.startDate|date('U') < x|date('U') %}
								{% if planning.endDate|date('U') == x|date('U') %}
									<td class="schedHour schedActive"></td>
									{% if planning.endHour == "am" %}
										<td class="schedHour"></td>
									{% else %}
										<td class="schedHour schedActive"></td>
									{% endif %}
									{% set currentPlanning = "" %}
									{% set empty = false %}
								{% elseif planning.endDate|date('U') > x|date('U') %}
									{% set currentPlanning = planning %}
									<td class="schedHour schedActive"></td>
									<td class="schedHour schedActive"></td>
									{% set empty = false %}
								{% endif %}
							{% endif %}
						{% endfor %}
					{% else %}
						{% set planning = currentPlanning %}
						{% if planning.endDate|date('U') == x|date('U') %}
							{% set currentPlanning = "" %}
							<td class="schedHour schedActive"></td>
							{% if planning.endHour == "am" %}
								<td class="schedHour"></td>
							{% else %}
								<td class="schedHour schedActive"></td>
							{% endif %}
							{% set currentPlanning = "" %}
							{% set empty = false %}
						{% elseif planning.endDate|date('U') > x|date('U') %}
							<td class="schedHour schedActive"></td>
							<td class="schedHour schedActive"></td>
							{% set empty = false %}
						{% endif %}
					{% endif %}
					{% if empty == true %}
						<td class="schedHour"></td>
						<td class="schedHour"></td>
					{% endif %}
				{% endfor %}
			</tr>
			{% endfor %}
		</tbody>
	</table>
{% endblock %}
